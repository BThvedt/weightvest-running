option_settings:
  aws:elasticbeanstalk:container:php:phpini:
    document_root: /web
    memory_limit: 1024M
    max_execution_time: 60

files:
  "/etc/httpd/conf.d/drupal.conf":
    mode: "000644"
    owner: root
    group: root
    content: |
      <Directory "/var/app/current/web">
        AllowOverride All
        Options -Indexes +FollowSymLinks
        DirectoryIndex index.php
        Require all granted
        
        # Enable mod_rewrite
        RewriteEngine On
        
        # Handle clean URLs
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteCond %{REQUEST_URI} !=/favicon.ico
        RewriteRule ^ index.php [L]
      </Directory>
      
      # Allow access to static files
      <FilesMatch "\.(css|js|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$">
        Require all granted
      </FilesMatch>

container_commands:
  01_enable_mod_rewrite:
    command: "echo 'LoadModule rewrite_module modules/mod_rewrite.so' > /etc/httpd/conf.modules.d/02-rewrite.conf"
  02_restart_httpd:
    command: "service httpd restart"
    ignoreErrors: true
  03_fix_permissions:
    command: "find /var/app/current/web -type f -name '*.css' -o -name '*.js' -o -name '*.png' -o -name '*.jpg' -o -name '*.gif' | xargs chmod 644"
    ignoreErrors: true
option_settings:
  aws:elasticbeanstalk:container:php:phpini:
    document_root: /web
    memory_limit: 1024M
    max_execution_time: 60

files:
  "/var/app/current/debug-nginx.php":
    mode: "000644"
    owner: webapp
    group: webapp
    content: |
      <?php
      echo "<h2>Nginx Debug Info</h2>";
      echo "<strong>REQUEST_URI:</strong> " . ($_SERVER['REQUEST_URI'] ?? 'Not set') . "<br>";
      echo "<strong>SCRIPT_NAME:</strong> " . ($_SERVER['SCRIPT_NAME'] ?? 'Not set') . "<br>";
      echo "<strong>PATH_INFO:</strong> " . ($_SERVER['PATH_INFO'] ?? 'Not set') . "<br>";
      echo "<strong>QUERY_STRING:</strong> " . ($_SERVER['QUERY_STRING'] ?? 'Not set') . "<br>";
      echo "<strong>DOCUMENT_ROOT:</strong> " . ($_SERVER['DOCUMENT_ROOT'] ?? 'Not set') . "<br>";
      echo "<strong>SCRIPT_FILENAME:</strong> " . ($_SERVER['SCRIPT_FILENAME'] ?? 'Not set') . "<br>";
      echo "<hr>";
      echo "<h3>All \$_SERVER variables:</h3>";
      echo "<pre>";
      print_r($_SERVER);
      echo "</pre>";
      ?>

container_commands:
  01_show_nginx_config:
    command: "echo '=== NGINX CONFIG ===' && cat /etc/nginx/nginx.conf"
  02_show_drupal_config:
    command: "echo '=== DRUPAL NGINX CONFIG ===' && ls -la /etc/nginx/conf.d/ && cat /etc/nginx/conf.d/*.conf"
  03_show_processes:
    command: "echo '=== PROCESSES ===' && ps aux | grep nginx"
  04_test_nginx_config:
    command: "echo '=== NGINX TEST ===' && nginx -t"
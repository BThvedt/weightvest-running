services:
  # Override the public stream wrapper
  stream_wrapper.public:
    class: Drupal\s3fs\StreamWrapper\S3fsStream
    tags:
      - { name: stream_wrapper, scheme: public }

  # Override the private stream wrapper
  stream_wrapper.private:
    class: Drupal\s3fs\StreamWrapper\S3fsStream
    tags:
      - { name: stream_wrapper, scheme: private }

  # Override core file storage service
  file.storage:
    class: Drupal\s3fs\S3fsFileStorage
    arguments: ["@stream_wrapper_manager", "@file_system", "@kernel", "@lock"]

  # Override CSS asset dumper to use S3
  asset.css.dumper:
    class: Drupal\s3fs\Asset\S3fsCssOptimizer
    arguments: ["@config.factory", "@file_url_generator"]

  # S3FS doesn't provide a JS optimizer - the file storage override should handle JS files

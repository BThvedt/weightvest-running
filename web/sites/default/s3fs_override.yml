services:
  # Override the public stream wrapper
  stream_wrapper.public:
    class: Drupal\s3fs\StreamWrapper\S3fsStream
    tags:
      - { name: stream_wrapper, scheme: public }

  # Override the private stream wrapper
  stream_wrapper.private:
    class: Drupal\s3fs\StreamWrapper\S3fsStream
    tags:
      - { name: stream_wrapper, scheme: private }

  # Override core file storage service
  file.storage:
    class: Drupal\s3fs\S3fsFileStorage
    arguments: ["@stream_wrapper_manager", "@file_system", "@kernel", "@lock"]

  # Override CSS/JS asset dumper to use S3
  asset.css.dumper:
    class: Drupal\s3fs\Asset\S3fsCssOptimizer
    arguments:
      [
        "@asset.css.collection_optimizer",
        "@file_system",
        "@config.factory",
        "@state",
        "@logger.channel.default",
        "@file_url_generator",
      ]

  asset.js.dumper:
    class: Drupal\s3fs\Asset\S3fsJsOptimizer
    arguments:
      [
        "@asset.js.collection_optimizer",
        "@file_system",
        "@config.factory",
        "@state",
        "@logger.channel.default",
        "@file_url_generator",
      ]
